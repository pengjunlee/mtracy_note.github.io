<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>设计模式系列之--静态代理模式 | 李朋军的个人博客</title><meta name="description" content="什么是静态代理模式？"><meta name="keywords" content="Java, 设计模式, 静态代理模式"><meta name="author" content="pengjunlee,pengjunlee@163.com"><meta name="copyright" content="pengjunlee"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="http://pengjunlee.3vzhuji.net/static/img/favicon.ico"><link rel="canonical" href="https://coder.mtracy.club/2020/07/18/design10/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="设计模式系列之--静态代理模式"><meta property="og:url" content="https://coder.mtracy.club/2020/07/18/design10/"><meta property="og:site_name" content="李朋军的个人博客"><meta property="og:description" content="什么是静态代理模式？"><meta property="og:image" content="http://pengjunlee.3vzhuji.net/static/img/top_img10.jpg"><meta property="article:published_time" content="2020-07-18T12:10:00.000Z"><meta property="article:modified_time" content="2020-07-18T12:10:00.000Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="设计模式系列之--动态代理模式（上）" href="https://coder.mtracy.club/2020/07/18/design11/"><link rel="next" title="设计模式系列之--观察者模式" href="https://coder.mtracy.club/2020/07/18/design09/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: {"text":"I,LOVE,YOU","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="http://pengjunlee.3vzhuji.net/static/img/avatar.png" onerror="onerror=null;src='http://pengjunlee.3vzhuji.net/static/img/cover1.jpg'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">87</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">6</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一、什么是代理模式"><span class="toc-text">一、什么是代理模式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二、静态代理模式的结构"><span class="toc-text">二、静态代理模式的结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三、静态代理模式应用举例"><span class="toc-text">三、静态代理模式应用举例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#应用一"><span class="toc-text">应用一</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用二"><span class="toc-text">应用二</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四、代理模式的应用场景"><span class="toc-text">四、代理模式的应用场景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#五、静态代理模式的特点"><span class="toc-text">五、静态代理模式的特点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#六、参考文章"><span class="toc-text">六、参考文章</span></a></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(http://pengjunlee.3vzhuji.net/static/img/top_img10.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">李朋军的个人博客</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">设计模式系列之--静态代理模式</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-07-18 12:10:00"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-07-18</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-07-18 12:10:00"><i class="fas fa-history fa-fw"></i> 更新于 2020-07-18</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="一、什么是代理模式"><a href="#一、什么是代理模式" class="headerlink" title="一、什么是代理模式"></a>一、什么是代理模式</h1><p>代理（Proxy）模式为其他对象提供一种代理以控制对这个对象的访问。（原文：The Proxy Pattern Provide a surrogate or placeholder for another object to control access to it.）</p>
<p>代理模式的作用：在客户端和被代理对象之间起到中介作用，通过代理可以有效地控制客户端对被代理对象的直接访问，进而可以很好地隐藏和保护被代理对象。</p>
<p>代理模式按照其代理类生成方式的不同又可以分为静态代理和动态代理两种，本章先跟大家来聊聊静态代理。</p>
<h1 id="二、静态代理模式的结构"><a href="#二、静态代理模式的结构" class="headerlink" title="二、静态代理模式的结构"></a>二、静态代理模式的结构</h1><p>代理模式是一种结构型设计模式，在代理模式中，代理与被代理的对象通常要实现相同的接口，以便在需要的时候可以使用代理来替代被代理对象，客户端必须通过代理与被代理对象进行交互，并且可以在交互的过程中（交互前后）添加一些额外的功能。</p>
<p>静态代理模式的UML结构示意图如下。</p>
<div align=center>

<p><img src= "/img/loading.gif" data-src="http://pengjunlee.3vzhuji.net/static/design_pattern/6.jpg" alt="静态代理模式结构示意图" title="静态代理模式结构示意图"></p>
<div align=left>

<p>静态代理模式涉及的角色及其职责：</p>
<ul>
<li>抽象主题(Subject)角色：这是一个抽象角色，通常被定义为接口，真实主题角色和代理主题角色都需实现此接口，以便将来可以使用代理主题对象来替代真实主题对象。</li>
<li>真实主题(RealSubject)角色：也叫被代理角色，是代理主题角色所代表的真实对象，是业务逻辑的实际执行者。</li>
<li>代理主题(Proxy)角色：也叫代理角色，该角色内部含有对真实主题对象的引用，从而可以操作真实主题对象，同时代理对象提供与真实主题对象相同的接口以便在任何时刻都能代替真实主题对象。通常代理角色会在将客户端调用传递给真实主题对象之前或者之后执行某些操作，而不是单纯地将调用传递给真实主题对象。</li>
</ul>
<p>静态代理模式结构示意源代码如下：</p>
<p><strong>抽象主题(Subject)角色</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">// 声明真实主题角色和代理主题角色都需实现的方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>真实主题(RealSubject)角色</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RealSubject</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//实现了抽象主题角色定义的接口</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"调用真实主题对象执行操作进行中..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>代理主题(Proxy)角色</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//包含一个真实主题对象的引用</span></span><br><span class="line">	<span class="keyword">private</span> Subject realSubject;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Proxy</span><span class="params">(Subject realSubject)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.realSubject = realSubject;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"调用真实主题对象之前进行的相关操作..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"调用真实主题对象之后进行的相关操作..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//通过调用内部真实主题对象的引用实现了抽象主题角色定义的接口，并添加了一些额外处理功能</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		before();</span><br><span class="line">		realSubject.operation();</span><br><span class="line">		after();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在MainClass中测一下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainClass</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Subject realSubject=<span class="keyword">new</span> RealSubject(); </span><br><span class="line">		Proxy proxy= <span class="keyword">new</span> Proxy(realSubject);</span><br><span class="line">		proxy.operation();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序打印结果如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">调用真实主题对象之前进行的相关操作...</span><br><span class="line">调用真实主题对象执行操作进行中...</span><br><span class="line">调用真实主题对象之后进行的相关操作...</span><br></pre></td></tr></table></figure>
<p>从上面的例子可以看出代理对象将客户端的调用委派给被代理对象，并在调用被代理对象的方法之前和之后执行了一些特殊操作，此种模式与装饰模式有点相似，两者的区别在于：代理模式的目的在于控制访问，装饰模式的目的在于添加功能。</p>
<blockquote>
<p>PS：不理解代理模式与装饰模式之间区别？没关系，待我们讲完接下来数据库连接池的例子，相信你一定会有所领悟。</p>
</blockquote>
<h1 id="三、静态代理模式应用举例"><a href="#三、静态代理模式应用举例" class="headerlink" title="三、静态代理模式应用举例"></a>三、静态代理模式应用举例</h1><p>在软件设计中，使用代理模式的意图很多，比如因为安全原因需要屏蔽客户端直接访问真实对象，或者在远程调用中需要使用代理类处理远程方法调用的技术细节 (如 RMI)，也可能为了提升系统性能，对真实对象进行封装，从而达到延迟加载的目的。</p>
<h2 id="应用一"><a href="#应用一" class="headerlink" title="应用一"></a>应用一</h2><p>我们都知道，对于一个简单的数据库应用，由于对于数据库的访问不是很频繁。这时可以简单地在需要访问数据库时，就新创建一个连接，用完后就关闭它，这样做也不会带来什么明显的性能上的开销。但是对于一个复杂的数据库应用，情况就完全不同了，频繁的建立、关闭数据库连接，会极大的降低系统的性能，此时，对于连接的使用就成了系统性能的瓶颈。</p>
<p>由于存在以上弊病，我们一般都是通过使用数据库连接池来解决连接问题，即创造一堆等待被使用的连接，等到用的时候就从连接池里取一个，不用了再放回去，数据库连接在整个应用启动期间，几乎是不关闭的。</p>
<p>但是在程序员编写程序的时候，会经常使用connection.close()这样的方法，去关闭数据库连接，而且这样做是对的，所以你并不能告诉程序员们说，你们使用连接都不要关了，去调用一个其他的类似方法将连接重新归还给连接池吧。这是不符合程序员的编程思维的，也很勉强，而且具有风险性，因为程序员会忘的。</p>
<p>解决这一问题的办法就是使用代理模式，因为通过代理可以有效控制客户端对被代理对象的直接访问，客户端只能通过代理与被代理对象进行交互，这样代理可以很轻易对被代理对象的行为进行扩展或者修改，而我们在这里要做的就是替换掉connection的close()方法。</p>
<p>为清晰起见，我在此重新创建了一个连接接口名为IConnection，它包含query()和close()两个方法。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IConnection</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">// 执行一条查询语句</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">()</span></span>;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">// 关闭连接</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来写一个实现的IConnection接口的ImpConnection类，它扮演了代理模式中的真实主题角色。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImpConnection</span> <span class="keyword">implements</span> <span class="title">IConnection</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"执行一条查询语句..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"关闭连接..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来我们要写代理类ConnectionProxy，代理类也要实现IConnection这个接口，由于通过继承方式实现代理模式不够灵活，推荐使用组合方式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionProxy</span> <span class="keyword">implements</span> <span class="title">IConnection</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">private</span> IConnection iConnection;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ConnectionProxy</span><span class="params">(IConnection iConnection)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.iConnection = iConnection;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">//对于我们不关心的方法，直接调用真实对象去处理</span></span><br><span class="line">		iConnection.query();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 不真正关闭连接，而是将连接归还给连接池</span></span><br><span class="line">		ConnectionPool.getInstance().returnConnection(iConnection);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来是连接池的简单代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionPool</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> LinkedList&lt;IConnection&gt; connectionList = <span class="keyword">new</span> LinkedList&lt;IConnection&gt;();</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> IConnection <span class="title">createNewConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ImpConnection();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">ConnectionPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (connectionList == <span class="keyword">null</span> || connectionList.size() == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>;) &#123;</span><br><span class="line">				System.out.println(<span class="string">"创建第 "</span> + (++i) + <span class="string">" 个连接..."</span>);</span><br><span class="line">				connectionList.add(createNewConnection());</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(<span class="string">"连接池初始化完成..."</span>);</span><br><span class="line">			showConnectionCount();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showConnectionCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"当前连接池可用连接数为： "</span> + connectionList.size());</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> IConnection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (connectionList.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="comment">// return connectionList.remove();</span></span><br><span class="line">			<span class="comment">// 这是原有的方式，直接返回连接，这样可能会出现程序员把连接给关闭掉的情况</span></span><br><span class="line">			<span class="comment">// 下面是使用代理的方式，程序员再调用close时，就会调用代理的close()方法把连接归还到连接池</span></span><br><span class="line">			IConnection iConnection = <span class="keyword">null</span>;</span><br><span class="line">			iConnection = connectionList.remove();</span><br><span class="line">			System.out.println(<span class="string">"从连接池获取一条连接..."</span>);</span><br><span class="line">			showConnectionCount();</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> ConnectionProxy(iConnection);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">returnConnection</span><span class="params">(IConnection connection)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"将连接归还给连接池。。。"</span>);</span><br><span class="line">		connectionList.add(connection);</span><br><span class="line">		showConnectionCount();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConnectionPool <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> ConnectionPoolInstance.connectionPool;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionPoolInstance</span> </span>&#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> ConnectionPool connectionPool = <span class="keyword">new</span> ConnectionPool();</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在MainClass里面测试一下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainClass</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 此条语句用来测试单例ConnectionPool是否实现延迟加载</span></span><br><span class="line">		<span class="comment">// 由于未使用连接，此条语句不会导致数据库连接池内连接初始化</span></span><br><span class="line">		ConnectionPool.showConnectionCount();</span><br><span class="line">		System.out.println(<span class="string">"----------接下来要从连接池取连接了----------"</span>);</span><br><span class="line">		IConnection connection = ConnectionPool.getInstance().getConnection();</span><br><span class="line">		System.out.println(<span class="string">"----------可以使用连接进行数据库操作了----------"</span>);</span><br><span class="line">		<span class="comment">// 使用连接执行查询语句</span></span><br><span class="line">		connection.query();</span><br><span class="line">		connection.query();</span><br><span class="line">		System.out.println(<span class="string">"----------连接用完了之后，该归还连接了----------"</span>);</span><br><span class="line">		connection.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序结果打印：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">当前连接池可用连接数为： 0</span><br><span class="line">----------接下来要从连接池取连接了----------</span><br><span class="line">创建第 1 个连接...</span><br><span class="line">创建第 2 个连接...</span><br><span class="line">创建第 3 个连接...</span><br><span class="line">创建第 4 个连接...</span><br><span class="line">创建第 5 个连接...</span><br><span class="line">创建第 6 个连接...</span><br><span class="line">创建第 7 个连接...</span><br><span class="line">创建第 8 个连接...</span><br><span class="line">创建第 9 个连接...</span><br><span class="line">创建第 10 个连接...</span><br><span class="line"></span><br><span class="line">连接池初始化完成...  </span><br><span class="line">当前连接池可用连接数为： 10  </span><br><span class="line"> </span><br><span class="line">从连接池获取一条连接...  </span><br><span class="line">当前连接池可用连接数为： 9  </span><br><span class="line"> </span><br><span class="line">----------可以使用连接进行数据库操作了----------  </span><br><span class="line">执行一条查询语句...  </span><br><span class="line">执行一条查询语句...  </span><br><span class="line"> </span><br><span class="line">----------连接用完了之后，该归还连接了----------  </span><br><span class="line">将连接归还给连接池。。。  </span><br><span class="line"> </span><br><span class="line">当前连接池可用连接数为： 10</span><br></pre></td></tr></table></figure>
<p>好了，这下我们的连接池返回的连接全是代理，就算程序员调用了close方法也只会把连接归还给连接池了。如果我们使用连接池getConnection()方法中被注释掉的语句 “<em>return connectionList.remove();</em>“ ，直接返回连接对象，那么以上MainClass中<em>连接用完了之后</em>连接池中的可用连接数将变为：9，即连接被真正关闭了。</p>
<p>我们使用代理模式解决了上述问题，从静态代理的使用上来看，我们一般是这么做的。</p>
<ol>
<li>代理类一般要持有一个被代理的对象的引用。</li>
<li>对于我们不关心的方法，全部委托给被代理的对象处理。</li>
<li>我们只处理我们关心的方法。</li>
</ol>
<h2 id="应用二"><a href="#应用二" class="headerlink" title="应用二"></a>应用二</h2><p>以上示例使用单例模式实现了ConnectionPool对象的延迟加载，示例稍微有点复杂，接下来我们再以一个简单的示例来感受一下使用代理模式实现延迟加载的方法及其意义。</p>
<p>延迟加载(lazy load)(也称为懒加载)是为了避免一些无谓的性能开销而提出来的，所谓延迟加载就是当在真正需要数据的时候，才去执行数据加载操作。延迟加载的实际应用很多：比如使用浏览器打开网站，浏览器一般总是先加载文本，待文本显示出来以后再加载图片、视频等耗时较多的资源，这样做的好处是用户不必非要等到所有东西都下载完成以后才能看到页面，可以极大地减少用户的等待时间；又比如Windows操作系统的启动过程，若我们将系统的所有服务项都设置为开机启动，那么我们每次启动计算机都需要等待非常长的时间，所以我们一般都是将系统必须的服务和一些常用服务设置为开机启动，对于那些不常用的服务我们只在用到的时候再去开启，这样做可以减少每次开机时系统启动所需时间，提高系统的启动速度。</p>
<p>接下来该引出我们的第二个例子了：</p>
<p>假设某客户端软件有根据用户请求去数据库查询数据的功能，在查询数据前，需要获得数据库连接，如果我们在软件开启时就去初始化并获得数据库连接，会存在以下弊端：软件开启时需初始化系统的所有类，如果系统还有大量类似资源耗费较多的操作(比如 XML 解析，本地或远程文件资源加载)也需在此时进行初始化，所有这些初始化操作的叠加会使得系统的启动速度变得非常缓慢。为此，我们使用代理模式的代理类对数据库查询类的初始化操作进行封装，当系统启动时，初始化这个代理类，而非真实的数据库查询类，由于此时代理类什么都没有做，因此，它的构造是相当迅速的。在用户真正做查询操作时再由代理类单独去加载真实的数据库查询类，完成用户的请求，这样就使用代理模式实现了延迟加载。</p>
<p>源代码如下：</p>
<p>定义一个接口 IConnection 作为抽象主题角色，该接口用来定义代理类和真实主题类需要对外提供的服务，本例只在其中定义了一个用来进行数据库查询的 query()方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IConnection</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ImpConnection 是真实主题角色，负责实际的业务操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImpConnection</span> <span class="keyword">implements</span> <span class="title">IConnection</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	ImpConnection() &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">				System.out.println(<span class="string">"ImpConnection对象创建中..."</span>);</span><br><span class="line">				Thread.sleep(<span class="number">1000</span>);<span class="comment">// 假设数据库连接等耗时操作</span></span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(<span class="string">"ImpConnection对象创建完成..."</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException ex) &#123;</span><br><span class="line">			ex.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"执行一次数据库查询操作..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ConnectionProxy 是 ImpConnection 的代理类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectionProxy</span> <span class="keyword">implements</span> <span class="title">IConnection</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">private</span> ImpConnection connection = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	    <span class="comment">// 在真正需要的时候才能创建真实对象，创建过程可能很慢</span></span><br><span class="line">	    <span class="keyword">if</span> (connection == <span class="keyword">null</span>) &#123;</span><br><span class="line">			connection = <span class="keyword">new</span> ImpConnection();</span><br><span class="line">		&#125;</span><br><span class="line">	    connection.query();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在MainClass中进行数据库查询测试。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainClass</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		IConnection connection = <span class="keyword">new</span> ConnectionProxy(); <span class="comment">// 使用代理</span></span><br><span class="line">		connection.query(); <span class="comment">// 在真正使用时才创建真实主题对象</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行程序结果打印：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ImpConnection对象创建中...</span><br><span class="line">ImpConnection对象创建中...</span><br><span class="line">ImpConnection对象创建中...</span><br><span class="line">ImpConnection对象创建完成...</span><br><span class="line">执行一次数据库查询操作...</span><br></pre></td></tr></table></figure>
<p>将MainClass中的 “connection.query();” 一行删除之后，将再没有任何结果打印到控制台，由此证明：若没有发生请求，将不会创建ImpConnection对象，使用代理模式实现了被代理对象延迟加载的功能。</p>
<p>使用代理模式实现延迟加载的核心思想是：如果当前并没有使用这个组件，则不需要真正地初始化它，使用一个代理对象替代它的原有的位置，只在真正需要的时候才对它进行加载。使用代理模式的延迟加载是非常有意义的，首先，它可以在时间轴上分散系统压力，尤其在系统启动时，不必完成所有的初始化工作，从而加快启动速度；其次，对很多真实主题而言，在软件启动直到被关闭的整个过程中，可能根本不会被调用，初始化这些数据无疑是一种资源浪费。例如上面这个例子，若系统不使用代理模式，则在启动时就要初始化 ImpConnection 对象，而使用代理模式后，启动时只需要初始化一个轻量级的 ConnectionProxy对象。 </p>
<h1 id="四、代理模式的应用场景"><a href="#四、代理模式的应用场景" class="headerlink" title="四、代理模式的应用场景"></a>四、代理模式的应用场景</h1><p>代理模式主要应用于以下几个场景：</p>
<ul>
<li>远程代理，也就是为一个对象在不同的地址空间提供局部代表，这样可以隐藏一个对象存在于不同地址空间的事实。比如说 WebService，当我们在应用程序的项目中加入一个 Web 引用，引用一个 WebService，此时会在项目中声称一个 WebReference 的文件夹和一些文件，这个就是起代理作用的，这样可以让那个客户端程序调用代理解决远程访问的问题；</li>
<li>虚拟代理，是根据需要创建开销很大的对象，通过它来存放实例化需要很长时间的真实对象。这样就可以达到性能的最优化，比如打开一个网页，这个网页里面包含了大量的文字和图片，但我们可以很快看到文字，但是图片却是一张一张地下载后才能看到，那些未打开的图片框，就是通过虚拟代理来替换了真实的图片，此时代理存储了真实图片的路径和尺寸；</li>
<li>安全代理，用来控制真实对象访问时的权限。一般用于对象应该有不同的访问权限的时候；</li>
<li>指针引用，是指当调用真实对象时，代理处理另外一些事。比如计算真实对象的引用次数，这样当该对象没有引用时，可以自动释放它，或当第一次引用一个持久对象时，将它装入内存，或是在访问一个实际对象前，检查是否已经释放它，以确保其他对象不能改变它。这些都是通过代理在访问一个对象时附加一些事务处理；</li>
<li>延迟加载，用代理模式实现延迟加载的一个经典应用就在 Hibernate 框架里面。当 Hibernate 加载实体 bean 时，并不会一次性将数据库所有的数据都装载。默认情况下，它会采取延迟加载的机制，以提高系统的性能。Hibernate 中的延迟加载主要分为属性的延迟加载和关联表的延时加载两类。实现原理是使用代理拦截原有的 getter 方法，在真正使用对象数据时才去数据库或者其他第三方组件加载实际的数据，从而提升系统性能。</li>
</ul>
<blockquote>
<p>PS：此外还有防火墙代理，智能引用代理，缓存代理，同步代理，复杂隐藏代理，写入时复制代理等等，都有各自特殊的用途。</p>
</blockquote>
<h1 id="五、静态代理模式的特点"><a href="#五、静态代理模式的特点" class="headerlink" title="五、静态代理模式的特点"></a>五、静态代理模式的特点</h1><p><strong>静态代理的优点：</strong></p>
<ul>
<li>被代理对象只要和代理类实现了同一接口即可，代理类无须知道被代理对象具体是什么类、怎么做的，而客户端只需知道代理即可，实现了类之间的解耦合。</li>
</ul>
<p><strong>静态代理的缺点：</strong></p>
<ul>
<li>代理类和被代理类实现了相同的接口，代理类通过被代理类实现了相同的方法，这样就出现了大量的代码重复。如果接口增加一个方法，除了所有实现类需要实现这个方法外，所有代理类也需要实现此方法，增加了代码维护的复杂度。</li>
<li>每个代理类只能为一个接口服务，如果程序开发中要使用代理的接口很多的话，必然会产生许多的代理类，造成类膨胀。</li>
</ul>
<h1 id="六、参考文章"><a href="#六、参考文章" class="headerlink" title="六、参考文章"></a>六、参考文章</h1><p><a href="http://http//www.lxway.com/4445954962.htm" target="_blank" rel="noopener" title="代理模式详解包含原理详解">http://http//www.lxway.com/4445954962.htm</a>  </p>
<p><a href="https://blog.csdn.net/lovelion/article/details/8116704" target="_blank" rel="noopener" title="Java动态代理的实现">https://blog.csdn.net/lovelion/article/details/8116704</a>  </p>
<p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-proxy-pattern/" target="_blank" rel="noopener" title="代理模式原理及实例讲解">https://www.ibm.com/developerworks/cn/java/j-lo-proxy-pattern/</a>  </p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:pengjunlee@163.com">pengjunlee</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://coder.mtracy.club/2020/07/18/design10/">https://coder.mtracy.club/2020/07/18/design10/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://coder.mtracy.club" target="_blank">李朋军的个人博客</a>！</span></div></div><div class="tag_share"><div class="post_share"><div class="social-share" data-image="http://pengjunlee.3vzhuji.net/static/img/top_img1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><button class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="http://pengjunlee.3vzhuji.net/static/img/WeChanQR.jpg" alt="微信支付" onclick="window.open('http://pengjunlee.3vzhuji.net/static/img/WeChanQR.jpg')"/><div class="post-qr-code__desc">微信支付</div></li><li class="reward-item"><img class="post-qr-code__img" src="http://pengjunlee.3vzhuji.net/static/img/AliPayQR.jpg" alt="支付宝" onclick="window.open('http://pengjunlee.3vzhuji.net/static/img/AliPayQR.jpg')"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></button></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/07/18/design11/"><img class="prev-cover" data-src="http://pengjunlee.3vzhuji.net/static/img/top_img11.jpg" onerror="onerror=null;src='http://pengjunlee.3vzhuji.net/static/img/cover2.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">设计模式系列之--动态代理模式（上）</div></div></a></div><div class="next-post pull-right"><a href="/2020/07/18/design09/"><img class="next-cover" data-src="http://pengjunlee.3vzhuji.net/static/img/top_img9.jpg" onerror="onerror=null;src='http://pengjunlee.3vzhuji.net/static/img/cover2.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">设计模式系列之--观察者模式</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/07/18/design22/" title="设计模式系列之--迭代器模式"><img class="relatedPosts_cover" data-src="http://pengjunlee.3vzhuji.net/static/img/top_img22.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-18</div><div class="relatedPosts_title">设计模式系列之--迭代器模式</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/18/design01/" title="设计模式系列之--简单工厂模式"><img class="relatedPosts_cover" data-src="http://pengjunlee.3vzhuji.net/static/img/top_img1.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-18</div><div class="relatedPosts_title">设计模式系列之--简单工厂模式</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/18/design03/" title="设计模式系列之--抽象工厂模式"><img class="relatedPosts_cover" data-src="http://pengjunlee.3vzhuji.net/static/img/top_img3.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-18</div><div class="relatedPosts_title">设计模式系列之--抽象工厂模式</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/18/design04/" title="设计模式系列之--单例模式"><img class="relatedPosts_cover" data-src="http://pengjunlee.3vzhuji.net/static/img/top_img4.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-18</div><div class="relatedPosts_title">设计模式系列之--单例模式</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/18/design08/" title="设计模式系列之--策略模式"><img class="relatedPosts_cover" data-src="http://pengjunlee.3vzhuji.net/static/img/top_img8.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-18</div><div class="relatedPosts_title">设计模式系列之--策略模式</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/18/design07/" title="设计模式系列之--装饰模式"><img class="relatedPosts_cover" data-src="http://pengjunlee.3vzhuji.net/static/img/top_img7.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-18</div><div class="relatedPosts_title">设计模式系列之--装饰模式</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'k0QcRvFFw7AovKS8un6pys2S-gzGzoHsz',
  appKey: 'Y5w42nyHhdKlYHT00svHuIya',
  placeholder: 'Please leave your footprints',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" style="background-image: url(http://pengjunlee.3vzhuji.net/static/img/top_img10.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By pengjunlee</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">簡</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fas fa-comments"></i></a><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script defer id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/third-party/ClickShowText.js"></script><script src="/js/search/local-search.js"></script></body></html>